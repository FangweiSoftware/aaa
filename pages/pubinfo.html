<div style='height:100%'>
    <table id="pubinfo_manage_table" style='height:100%'>
        <tbody id='pubinfo_manage_tbody'>

        </tbody>
    </table>
</div>
<script>
    $.ajax({
        type:'get',
        url:WEBAPI_ADDRESS+'/api/Tc_pubinfo_basic/GetByPage',
        data:{
            Num:20,
            Pno:1,
        },
        success:function(res){
            $.each(res.data,function (index,item){
                item.createtime=moment(item.createtime).format('YYYY/MM/DD');
                item.edittime=moment(item.edittime).format('YYYY/MM/DD');
            });
            var html = template('pubinfo_manage_temp',{data:res.data});
            $('#pubinfo_manage_tbody').html(html);
            $('#pubinfo_manage_table').datagrid({
                /**开启分页*/
                pagination: true,
                /**默认是服务器排序，这里需要手动关闭，切换为客户端排序*/
                remoteSort: false,
                /**单条选择模式*/
                singleSelect: false,
                /**配置*/
                fitColumns:true,
                autoRowHeight:false,

                columns: [[
                    /**sortable：true 开启排序*/
                    {field: 'itemno', title: "序号", sortable: true,width:'5%',resizable:false,},
                    {field: 'createtime', title: "日期", sortable: true,width:'5%',resizable:false,},
                    {field: 'name', title: "名称", sortable: true,width:'5%',resizable:false,},
                    {field: 'type', title: "类型", sortable: true,width:'5%',resizable:false,},
                    {field: 'pubno', title: "编号", sortable: true,width:'5%',resizable:false,},
                    {field: 'manager', title: "辖区大队", sortable: true,width:'5%',resizable:false,},
                    {field: 'pubfrom', title: "舆情来源", sortable: true,width:'5%',resizable:false,},
                    {field: 'degree', title: "紧急程度", sortable: true,width:'5%',resizable:false,},
                    {field: 'problemtype', title: "问题分类", sortable: true,width:'5%',resizable:false,},
                    {field: 'description', title: "问题描述", sortable: true,width:'5%',resizable:false,},
                    {field: 'approach', title: "解决措施", sortable: true,width:'5%',resizable:false,},
                    {field: 'sysflag', title: "优化任务", width:'5%',resizable:false,},
                    {field: 'processdate', title: "处理日期", sortable: true,width:'5%',resizable:false,},
                    {field: 'processresult', title: "处理结果", sortable: true,width:'5%',resizable:false,},
                    {field: 'attach', title: "舆情附录", width:'5%',resizable:false,},
                    {field: 'advice', title: "处理意见", sortable: true,width:'5%',resizable:false,},
                    {field: 'state', title: "任务状态", sortable: true,width:'5%',resizable:false,},
                    {field: 'operation', title: "操作",width:'5%',sortable: true,resizable:false,}
                ]],
                onLoadSuccess: function(){
//                    $('#pubinfo_manage_table').datagrid('freezeRow',0).datagrid('freezeRow',1);
                },
            });
        }
    });



</script>
<script type='text/html' id='pubinfo_manage_temp'>
    {{each data}}
    <tr data-id='{{$value.pubinfoid}}' data-pubno='{{$value.pubno}}' data-tuneid='{{$value.tuneid}}' data-pubfrom='{{$value.pubfrom}}' data-description='{{$value.description}}'>
        <td>{{$value.pubno}}</td>
        <td>{{$value.createtime}}</td>
        <td>{{$value.name}}</td>
        <td >{{$value.type==0?'路口':'绿路'}}</td>
        <td>{{$value.itemno}}</td>
        <td>{{$value.manager}}</td>
        <td>{{$value.pubfrom}}</td>
        <td>{{$value.degree}}</td>
        <td>{{$value.problemtype}}</td>
        <td >{{$value.description}}</td>
        <td >{{$value.approach}}</td>
        <td data-tuneid='{{$value.tuneid}}' data-pubinfoid='{{$value.pubinfoid}}' data-itemno='{{$value.itemno}}' data-type='{{$value.type}}'>
            {{if ($value.tuneid)}}
            <button class='btn btn-xs btn-db checkOptimize'>查看</button>
            {{else}}
            <button class='btn btn-xs btn-db addOptimize' data-tuneid=''>新建</button>
            {{/if}}
        </td>
        <td>{{$value.edittime}}</td>
        <td>{{$value.processresult}}</td>
        <td  data-id='{{$value.pubinfoid}}' data-itemno='{{$value.itemno}}' data-index='{{$index}}'>
            <button class="btn btn-xs btn-db download-att">查看</button>
        </td>
        <td>
            {{if ($value.advice!="")}}
            {{$value.advice}}
            {{else}}
            <!--<button class="btn btn-xs btn-db add_pro_pic" data-toggle="modal" data-target="#upload_modal">新建</button>-->
            {{/if}}
        </td>
        <td>{{$value.state}}</td>
        <td >
            {{if ($value.sysflag==-2)}}
            <span>已归档</span>
            {{else}}
            <p><button class="btn btn-xs btn-db mt-5 edit-pubinfo">编辑</button></p>
            <p><button class="btn btn-xs btn-db mt-5 delete_pubinfo">删除</button></p>
            <p><button class="btn btn-xs btn-db mt-5 save-doc">归档</button></p>
            {{/if}}
        </td>
    </tr>
    {{/each}}
    <tr>
        <td colspan=18 style='height: 20px;'>
            <button class='add-pub-info btn' id='pib_tb_add' onclick="toAddPb(3)">
                <i></i>
            </button>
        </td>
    </tr>
</script>